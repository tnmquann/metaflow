// conf/modules.config
process {
    withName: 'FASTQC_RAW' {
        publishDir = [
            [
                path: { "${params.qc_raw_dir}/${meta.id}" },
                mode: 'copy',
                pattern: "*_fastqc.{html,zip}"
            ],
            [
                path: { "${params.qc_raw_dir}" },
                mode: params.publish_dir_mode,
                pattern: "versions.yml"
            ]
        ]
    }

    // withName: 'MULTIQC_RAW' {
    //     publishDir = [
    //         [
    //             path: { "${params.qc_raw_dir}/MultiQC" },
    //             mode: 'copy',
    //             pattern: "*multiqc_report.html",
    //             saveAs: { "raw_shortreads_multiqc_report.html" }
    //         ]
    //     ]
    // }

    withName: 'FASTP' {
        publishDir = [
            [
                path: { "${params.trim_dir}/${meta.id}" },
                mode: 'copy',
                pattern: "*.fastq.gz"
            ],
            [
                path: { "${params.trim_dir}/${meta.id}/report" },
                mode: 'copy',
                pattern: "*.{json,html}"
            ],
            [
                path: { "${params.trim_dir}" },
                mode: params.publish_dir_mode,
                pattern: "versions.yml"
            ]
        ]
    }

    withName: 'FASTQC_TRIMMED' {
        publishDir = [
            [
                path: { "${params.qc_trim_dir}/${meta.id}" },
                mode: 'copy',
                pattern: "*_fastqc.{html,zip}"
            ],
            [
                path: { "${params.qc_trim_dir}" },
                mode: params.publish_dir_mode,
                pattern: "versions.yml"
            ]
        ]
    }

    // withName: 'MULTIQC_TRIMMED' {
    //     publishDir = [
    //         [
    //             path: { "${params.qc_trim_dir}/MultiQC" },
    //             mode: 'copy',
    //             pattern: "*multiqc_report.html",
    //             saveAs: { "trimmed_shortreads_multiqc_report.html" }
    //         ]
    //     ]
    // }

    withName: 'HOSTILE_CLEAN' {
        publishDir = [
            [
                path: { "${params.rmhost_dir}/${meta.id}" },
                mode: 'copy',
                pattern: "cleaned_reads/*.fastq.gz"
            ],
            [
                path: { "${params.rmhost_dir}/${meta.id}/report" },
                mode: 'copy',
                pattern: "*.json"
            ],
            [
                path: { "${params.rmhost_dir}" },
                mode: params.publish_dir_mode,
                pattern: "versions.yml"
            ]
        ]
    }

    withName: 'FASTQC_RMHOST' {
        publishDir = [
            [
                path: { "${params.qc_rmhost_dir}/${meta.id}" },
                mode: 'copy',
                pattern: "*_fastqc.{html,zip}"
            ],
            [
                path: { "${params.qc_rmhost_dir}" },
                mode: params.publish_dir_mode,
                pattern: "versions.yml"
            ]
        ]
    }

    // withName: 'MULTIQC_RMHOST' {
    //     publishDir = [
    //         [
    //             path: { "${params.qc_rmhost_dir}/MultiQC" },
    //             mode: 'copy',
    //             pattern: "*multiqc_report.html",
    //             saveAs: { "rmhost_shortreads_multiqc_report.html" }
    //         ]
    //     ]
    // }

    // RGI modules configuration
    // withName: 'RGI_PREPARECARDDB' {
    //     publishDir = [
    //         [
    //             path: { "${params.rgi_preparecarddb_dir ?: "${params.outdir}/RGI/database"}" },
    //             mode: params.publish_dir_mode ?: 'copy',
    //             saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
    //         ]
    //     ]
    // }

    // withName: 'RGI_BWT' {
    //     ext.prefix = params.rgi_bwt_prefix ?: { "${meta.id}" }
    //     publishDir = [
    //         [
    //             path: { "${params.rgi_dir ?: "${params.outdir}/RGI"}/bwt/${meta.id}" },
    //             mode: params.publish_dir_mode ?: 'copy',
    //             pattern: "*/",
    //             saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
    //         },
    //         [
    //             path: { "${params.rgi_dir ?: "${params.outdir}/RGI"}/bwt/${meta.id}/json" },
    //             mode: params.publish_dir_mode ?: 'copy',
    //             pattern: "*.json"
    //         },
    //         [
    //             path: { "${params.rgi_dir ?: "${params.outdir}/RGI"}/bwt/${meta.id}/tsv" },
    //             mode: params.publish_dir_mode ?: 'copy',
    //             pattern: "*.txt"
    //         }
    //     ]
    // }

    withName: 'RGI_PREPARECARDDB' {
        publishDir = [
            path: { "${params.rgi_dir}/database" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename }
        ]
    }
    withName: 'RGI_BWT' {
        publishDir = [
            path: { "${params.rgi_dir}/bwt" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename }
        ]
    }

    withName: 'YACHT_RUN' {
        publishDir = [
            [
                path: { "${params.yacht_results_dir}" },
                mode: params.publish_dir_mode,
                pattern: "yacht_results/*.xlsx"
            ],
            [
                path: { "${params.yacht_results_dir}/yacht_results/version" },
                mode: params.publish_dir_mode,
                pattern: "versions.yml"
            ]
        ]
    }

    withName: 'SOURMASH_FASTMULTIGATHER' {
        publishDir = [
            [
                path: { "${params.fastmultigather_dir}" },
                mode: params.publish_dir_mode,
                pattern: "fastmultigather/*_sourmash_gather.csv"
            ],
            [
                path: { "${params.fastmultigather_dir}/fastmultigather" },
                mode: params.publish_dir_mode,
                pattern: "versions.yml"
            ]
        ]
    }

    // withName: 'PROCESS_READBASED_RESULTS' {
    //     publishDir = [
    //         [
    //             path: { "${params.processed_results_dir}" },
    //             mode: params.publish_dir_mode,
    //             pattern: "final_results/*"
    //         ],
    //         [
    //             path: { "${params.processed_results_dir}/final_results/version" },
    //             mode: params.publish_dir_mode,
    //             pattern: "versions.yml"
    //         ],
    //         [
    //             path: { "${params.yacht_results_dir}/yacht_results" },
    //             mode: params.publish_dir_mode,
    //             pattern: "temp_yacht_results"
    //         ]
    //     ]
    // }
}